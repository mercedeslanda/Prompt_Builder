<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Generador de Prompts UrbanalÃ­tica</title>
  <style>
    body {
      font-family: sans-serif;
      padding: 2rem;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      text-align: center;
    }
    select, button, input {
      margin: 0.5rem 0;
      padding: 0.5rem;
      width: 300px;
      text-align: center;
    }
    #output {
      margin-top: 1rem;
      background: #f0f0f0;
      padding: 1rem;
      border-radius: 8px;
      width: fit-content;
    }
    label {
      margin-top: 1rem;
      font-weight: bold;
      display: block;
    }
  </style>
</head>
<body>

  <h1>Generador de Prompt Visual â€“ UrbanalÃ­tica</h1>
  <p>Selecciona mÃºltiples opciones por categorÃ­a usando <strong>Ctrl / Cmd + clic</strong>:</p>
  <div id="selectors"></div>
  <hr>
  <label for="sref">ğŸ¨ Estilo visual (URL para <code>--sref</code>)</label>
  <input type="url" id="sref" placeholder="https://...">
  <label for="iw">ğŸ–¼ï¸ Imagen guÃ­a (URL para <code>--iw</code>)</label>
  <input type="url" id="iw" placeholder="https://...">
  <label for="oref">ğŸ” Imagen exacta (URL para <code>--oref</code>)</label>
  <input type="url" id="oref" placeholder="https://...">
  <hr>
  <label for="params">âš™ï¸ ParÃ¡metros Midjourney</label>
  <select id="params" multiple>
    <option value="--ar 16:9">--ar 16:9 â†’ Imagen horizontal</option>
    <option value="--ar 9:16">--ar 9:16 â†’ Imagen vertical</option>
    <option value="--style raw">--style raw â†’ Sin estilizaciÃ³n automÃ¡tica</option>
    <option value="--s 550">--s 550 â†’ Stylize bajo</option>
    <option value="--s 10">--s 10 â†’ Stylize mÃ­nimo</option>
    <option value="--s 1000">--s 1000 â†’ Stylize alto</option>
    <option value="--weird 0">--weird 0 â†’ Sin rareza</option>
    <option value="--chaos 50">--chaos 50 â†’ Aleatoriedad media</option>
  </select>
  <button onclick="buildPrompt()">ğŸ” Generar Prompt</button>
  <button onclick="copyPrompt()">ğŸ“‹ Copiar Prompt</button>
  <h2 id="output">Prompt generado aparecerÃ¡ aquÃ­â€¦</h2>

<script>
  // 1) FunciÃ³n para normalizar texto a un id vÃ¡lido
  function normalizeId(text) {
    return text
      .normalize('NFD')
      .replace(/[\u0300-\u036f]/g, '')
      .replace(/[^a-zA-Z0-9]+/g, '_')
      .replace(/^_|_$/g, '')
      .toLowerCase();
  }

  // 2) Lee el CSV entero y devuelve { headers: [...], rows: [ [...], ... ] }
  async function loadCSV(path) {
  const res = await fetch(path);
  const text = await res.text();
  const lines = text.trim().split('\n').map(r => r.trim());
  const headers = lines[0]
    .split(',')
    .map(h => h.trim().replace(/^"|"$/g, ''));
  const rows = lines.slice(1).map(line =>
    line.split(',').map(cell =>
      cell.trim().replace(/^"(.*)"$/, '$1')
    )
  );
  return { headers, rows };
}


  // 3) Construye el objeto 'variables' automÃ¡ticamente
  function buildVariables(headers, rows) {
    const vars = {};
    headers.forEach(h => vars[h] = []);
    rows.forEach(cells => {
      headers.forEach((h, i) => {
        const v = cells[i];
        if (v && !vars[h].includes(v)) vars[h].push(v);
      });
    });
    return vars;
  }

  // 4) Genera los <select> para cada header
  function buildSelectors(variables) {
    const container = document.getElementById("selectors");
    container.innerHTML = '';
    Object.entries(variables).forEach(([header, options]) => {
      const id = normalizeId(header);
      // etiqueta
      container.innerHTML += `<label for="${id}">${header}</label>`;
      // select mÃºltiple
      const sel = document.createElement("select");
      sel.id = id;
      sel.multiple = true;
      options.forEach(optVal => {
        const opt = document.createElement("option");
        opt.value = optVal;
        opt.innerText = optVal;
        sel.appendChild(opt);
      });
      container.appendChild(sel);
    });
  }

  // 5) Helper para leer valores seleccionados
  function getSelected(id, sep = ", ") {
    const sel = document.getElementById(id);
    return sel
      ? Array.from(sel.selectedOptions).map(o => o.value).join(sep)
      : "";
  }

  // 6) Monta el prompt
  function buildPrompt() {
    // todos los selects (salvo params) en orden de apariciÃ³n
    const parts = [];
    // si hay imagen guÃ­a
    const iw = document.getElementById("iw").value.trim();
    if (iw) parts.push(iw);

    // recorre cada selector generado
    document.querySelectorAll("#selectors select").forEach(sel => {
      const vals = getSelected(sel.id);
      if (vals) parts.push(vals);
    });

    // sufijos: sref, oref, iw y params
    const sref = document.getElementById("sref").value.trim();
    const oref = document.getElementById("oref").value.trim();
    let suffix = "";
    if (sref) suffix += ` --sref ${sref}`;
    if (oref) suffix += ` --oref ${oref}`;
    if (iw) suffix += ` --iw 2`;

    const params = getSelected("params", " ");
    if (params) suffix += ` ${params}`;

    document.getElementById("output").innerText = parts.join(" ") + suffix;
  }

  // 7) Copiar al portapapeles
  function copyPrompt() {
    const txt = document.getElementById("output").innerText;
    navigator.clipboard.writeText(txt).then(
      () => alert("âœ… Prompt copiado al portapapeles"),
      () => alert("âŒ Error al copiar")
    );
  }

  // 8) InicializaciÃ³n: carga CSV y construye selects
  (async () => {
    try {
      const { headers, rows } = await loadCSV("Prompts_Urbanal_tica_Final.csv");
      const variables = buildVariables(headers, rows);
      buildSelectors(variables);
    } catch (e) {
      console.error(e);
      alert("âŒ OcurriÃ³ un error cargando las variables: revisa consola");
    }
  })();
</script>


</body>
</html>
